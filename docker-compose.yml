version: '3.8'

# docker-compose.yml — Infrastructure as Code
#
# This file defines the local development environment as code.
# It describes two services: the web application and a test runner.
# Anyone with Docker installed can reproduce this environment exactly
# by running: docker compose up
#
# Compare this to a manual setup document: this file IS the setup.
# It is version-controlled, reviewable, and executable.

services:

  # The web application, served by Nginx inside a container.
  # Port 8080 on your machine maps to port 80 inside the container.
  # After running `docker compose up web`, visit http://localhost:8080
  web:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8080:80"
    volumes:
      # Mount the local directory into the container.
      # Changes you make to files on your machine are immediately reflected
      # inside the container — no need to rebuild the image during development.
      - .:/usr/share/nginx/html:ro

  # A Node.js environment for running the test suite inside a container.
  # This ensures tests run against the same Node.js version as CI,
  # regardless of what you have installed locally.
  # Run with: docker compose run test-runner
  test-runner:
    image: node:20-alpine
    working_dir: /app
    volumes:
      - .:/app
    command: npm test
    # Prevent the test runner from starting automatically with `docker compose up`
    profiles:
      - testing
